
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Exercice 8 : Boite √† outils de g√©otraitement &#8212; Documentation PythonQGIS_TP 2020</title>
    <link rel="stylesheet" href="_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/js/custom.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Cheatsheet" href="cheatsheet.html" />
    <link rel="prev" title="Exercice 6 : Manipulation de couches vecteurs et g√©otraitements" href="ex6.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index g√©n√©ral"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cheatsheet.html" title="Cheatsheet"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="ex6.html" title="Exercice 6 : Manipulation de couches vecteurs et g√©otraitements"
             accesskey="P">pr√©c√©dent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation PythonQGIS_TP 2020</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contenu</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Exercice 8 : Boite √† outils de g√©otraitement</a><ul>
<li><a class="reference internal" href="#objectif">Objectif</a></li>
<li><a class="reference internal" href="#nouvelles-notions">Nouvelles notions</a></li>
<li><a class="reference internal" href="#exercice">Exercice</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
  <h4>Sujet pr√©c√©dent</h4>
  <p class="topless"><a href="ex6.html"
                        title="Chapitre pr√©c√©dent">Exercice 6 : Manipulation de couches vecteurs et g√©otraitements</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="cheatsheet.html"
                        title="Chapitre suivant">Cheatsheet</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ex8.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="index.html">Docs</a></li>
              
              <li>Exercice 8 : Boite √† outils de g√©otraitement</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="exercice-8-boite-a-outils-de-geotraitement">
<h1>Exercice 8 : Boite √† outils de g√©otraitement<a class="headerlink" href="#exercice-8-boite-a-outils-de-geotraitement" title="Lien permanent vers ce titre">¬∂</a></h1>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_0.png"><img alt="_images/tp8_0.png" src="_images/tp8_0.png" style="width: 40%;" /></a>
</div>
<p class="rubric"></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="objectif">
<h2>Objectif<a class="headerlink" href="#objectif" title="Lien permanent vers ce titre">¬∂</a></h2>
<ul class="simple">
<li>D√©couvrir et utiliser les algorithmes de la boite √† outils de g√©otraitement (<em>processing algorithms</em>) en Python.</li>
<li>Combiner plusieurs g√©otraitements pour r√©pondre √† une question d‚Äôanalyse spatiale.</li>
</ul>
</div>
<div class="section" id="nouvelles-notions">
<h2>Nouvelles notions<a class="headerlink" href="#nouvelles-notions" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>L‚Äôensemble des <strong>g√©otraitements</strong> disponibles sous forme de boites de dialogues dans QGIS est √©galement accessible au travers de l‚ÄôAPI Python.
C‚Äôest √©galement le cas pour les g√©otraitements propos√©es dans QGIS par les extensions GRASS, SAGA et GDAL.</p>
<p>Contraitement aux manipulations que nous avons effectu√©es auparavant, ces g√©otraitements prennent en entr√©e une (ou plusieurs) couche(s) et produisent g√©n√©ralement une couche en sortie.
Il s‚Äôagit par exemple de traitements tels que :</p>
<ul class="simple">
<li>Cr√©ation de Polygones Voronoi</li>
<li>Cr√©ation d‚Äôune grille au format vecteur</li>
<li>Fusion des entit√©s d‚Äôun couche</li>
<li>Rast√©riserisation d‚Äôune couche vecteur</li>
<li>Etc.</li>
</ul>
<p>En utilisant le code suivant, il est possible de lister l‚Äôensemble des algorithmes disponibles dans QGIS :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">QgsApplication</span><span class="o">.</span><span class="n">processingRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">algorithms</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> --&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alg</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">alg</span><span class="o">.</span><span class="n">displayName</span><span class="p">()))</span>
</pre></div>
</div>
<p>Le texte qui s‚Äôaffiche est de la forme :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">native</span><span class="p">:</span><span class="n">centroids</span> <span class="o">--&gt;</span> <span class="n">Centro√Ødes</span>
<span class="n">native</span><span class="p">:</span><span class="n">clip</span> <span class="o">--&gt;</span> <span class="n">Couper</span>
<span class="o">...</span>
</pre></div>
</div>
<p>La partie de gauche d√©signe l‚Äôidenfifiant de l‚Äôalgorithme (<code class="docutils literal notranslate"><span class="pre">native:centroids</span></code> par exemple)
et celle de droite son intitul√© (<code class="docutils literal notranslate"><span class="pre">Centro√Ødes</span></code> par exemple) dans la langue utilis√©e par QGIS <em>(ici le fran√ßais - certains intitul√©s ne sont toutefois pas traduits)</em>.
Il est ainsi possible d‚Äôacc√©der en Python √† l‚Äôensemble des g√©otraitements de la boite √† outils.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_1.png"><img alt="_images/tp8_1.png" src="_images/tp8_1.png" style="width: 100%;" /></a>
</div>
<p>L‚Äôacc√®s √† ces algorithmes se fait via le module <code class="docutils literal notranslate"><span class="pre">processing</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">processing</span>
</pre></div>
</div>
<p><strong>‚ûú La fonction</strong> <code class="docutils literal notranslate"><span class="pre">algorithmHelp</span></code> <strong>va permettre d‚Äôafficher l‚Äôaide d‚Äôun algorithme</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">processing</span><span class="o">.</span><span class="n">algorithmHelp</span><span class="p">(</span><span class="s2">&quot;native:centroids&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Il est indispensable de lire la documentation d‚Äôun algorithme avant de l‚Äôutiliser : c‚Äôest elle qui indique quels sont les param√®tres requis pour l‚Äôutiliser.</p>
<blockquote>
<div>L‚Äôaide des diff√©rents g√©otraitements peut √©galement √™tre affich√©e au format HTML √† partir de la page : <a class="reference external" href="https://docs.qgis.org/3.10/en/docs/user_manual/processing_algs/index.html">https://docs.qgis.org/3.10/en/docs/user_manual/processing_algs/index.html</a>.</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Centro√Ødes</span> <span class="p">(</span><span class="n">native</span><span class="p">:</span><span class="n">centroids</span><span class="p">)</span>

<span class="n">Cet</span> <span class="n">algorithme</span> <span class="n">cr√©√©</span> <span class="n">un</span> <span class="n">nouvelle</span> <span class="n">couche</span> <span class="n">de</span> <span class="nb">type</span> <span class="n">point</span><span class="p">,</span> <span class="n">ou</span> <span class="n">les</span> <span class="n">points</span> <span class="n">repr√©sentent</span> <span class="n">le</span> <span class="n">barycentre</span> <span class="n">des</span> <span class="n">entit√©s</span> <span class="n">d</span><span class="s1">&#39;une couche d&#39;</span><span class="n">entr√©e</span><span class="o">.</span>

<span class="n">Les</span> <span class="n">attributs</span> <span class="n">associ√©s</span> <span class="n">aux</span> <span class="n">points</span> <span class="n">dans</span> <span class="n">la</span> <span class="n">couche</span> <span class="n">de</span> <span class="n">sortie</span>  <span class="n">sont</span> <span class="n">ceux</span> <span class="n">des</span> <span class="n">points</span> <span class="n">de</span> <span class="n">la</span> <span class="n">couche</span> <span class="n">d</span><span class="s1">&#39;origine.</span>


<span class="o">----------------</span>
<span class="n">Input</span> <span class="n">parameters</span>
<span class="o">----------------</span>

<span class="n">INPUT</span><span class="p">:</span> <span class="n">Couche</span> <span class="n">source</span>

      <span class="n">Parameter</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QgsProcessingParameterFeatureSource</span>

      <span class="n">Accepted</span> <span class="n">data</span> <span class="n">types</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">ID</span> <span class="n">de</span> <span class="n">couche</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">nom</span> <span class="n">de</span> <span class="n">couche</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">couche</span> <span class="n">source</span>
              <span class="o">-</span> <span class="n">QgsProcessingFeatureSourceDefinition</span>
              <span class="o">-</span> <span class="n">QgsProperty</span>
              <span class="o">-</span> <span class="n">QgsVectorLayer</span>

<span class="n">ALL_PARTS</span><span class="p">:</span> <span class="n">Cr√©er</span> <span class="n">un</span> <span class="n">centro√Øde</span> <span class="n">pour</span> <span class="n">chaque</span> <span class="n">partie</span>

      <span class="n">Parameter</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QgsProcessingParameterBoolean</span>

      <span class="n">Accepted</span> <span class="n">data</span> <span class="n">types</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">bool</span>
              <span class="o">-</span> <span class="nb">int</span>
              <span class="o">-</span> <span class="nb">str</span>
              <span class="o">-</span> <span class="n">QgsProperty</span>

<span class="n">OUTPUT</span><span class="p">:</span> <span class="n">Centro√Ødes</span>

      <span class="n">Parameter</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QgsProcessingParameterFeatureSink</span>

      <span class="n">Accepted</span> <span class="n">data</span> <span class="n">types</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">fichier</span> <span class="n">vecteur</span> <span class="n">de</span> <span class="n">destination</span><span class="p">,</span> <span class="n">par</span> <span class="n">ex</span><span class="o">.</span> <span class="s1">&#39;d:/test.shp&#39;</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span> <span class="n">pour</span> <span class="n">stocker</span> <span class="n">le</span> <span class="n">r√©sultat</span> <span class="n">dans</span> <span class="n">une</span> <span class="n">couche</span> <span class="n">temporaire</span> <span class="n">en</span> <span class="n">m√©moire</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">using</span> <span class="n">vector</span> <span class="n">provider</span> <span class="n">ID</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">destination</span> <span class="n">URI</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="s1">&#39;postgres:‚Ä¶&#39;</span> <span class="n">to</span> <span class="n">store</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">PostGIS</span> <span class="n">table</span>
              <span class="o">-</span> <span class="n">QgsProcessingOutputLayerDefinition</span>
              <span class="o">-</span> <span class="n">QgsProperty</span>

<span class="o">----------------</span>
<span class="n">Outputs</span>
<span class="o">----------------</span>

<span class="n">OUTPUT</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">QgsProcessingOutputVectorLayer</span><span class="o">&gt;</span>
      <span class="n">Centro√Ødes</span>
</pre></div>
</div>
<p>Cette aide nous apprend :</p>
<ul class="simple">
<li>Que l‚Äôalgorithme s‚Äôutilise avec 3 param√®tres d‚Äôentr√©e : <code class="docutils literal notranslate"><span class="pre">INPUT</span></code>, <code class="docutils literal notranslate"><span class="pre">ALL_PARTS</span></code> et <code class="docutils literal notranslate"><span class="pre">OUTPUT</span></code> <em>(nous allons voir comment les utiliser simplement ensuite)</em>,</li>
<li>Que le r√©sultat attendu est de type <code class="docutils literal notranslate"><span class="pre">QgsProcessingOutputVectorLayer</span></code> : cet objet va nous permettre d‚Äôobtenir une couche de type <code class="docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code> comme manipul√©e dans les TP pr√©c√©dents si l‚Äô√©x√©cution se d√©roule sans probl√®me.</li>
</ul>
<p><strong>‚ûú La fonction</strong> <code class="docutils literal notranslate"><span class="pre">run</span></code> <strong>va permettre d‚Äô√©x√©cuter l‚Äôalgorithme</strong>.</p>
<p>Son premier argument est l‚Äôidentifiant de l‚Äôalgorithme √† √©x√©cuter et son second argument est un dictionnaire Python (objet <code class="docutils literal notranslate"><span class="pre">dict</span></code>) d√©crivant
les param√®tres de l‚Äôalgorithme (couche(s) en entr√©es, type de sortie, √©ventuelles options.)</p>
<p>L‚Äôexemple suivant utilise une de mes couches (nomm√©e <code class="docutils literal notranslate"><span class="pre">park</span></code> dans mon projet QGIS) pour calculer le centroide de chaque entit√©.
Le r√©sultat est stock√© dans une couche temporaire en m√©moire et est ajout√© au projet actuel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">mapLayersByName</span><span class="p">(</span><span class="s2">&quot;park&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="s2">&quot;native:centroids&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">layer</span><span class="p">,</span> <span class="s1">&#39;ALL_PARTS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;TEMPORARY_OUTPUT&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>L‚Äôex√©cution du code pr√©c√©dent correspond ainsi √† l‚Äôaction suivante dans l‚Äôinterface de QGIS :</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_2.png"><img alt="_images/tp8_2.png" src="_images/tp8_2.png" style="width: 100%;" /></a>
</div>
<p>Dans l‚Äôinterface, on retrouve √©galement apr√®s l‚Äô√©x√©cution, dans l‚Äôonglet <code class="docutils literal notranslate"><span class="pre">Journal</span></code> le dictionnaire des <strong>param√®tres en entr√©e</strong>
utilis√© pour ce g√©otraitement :</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_3.png"><img alt="_images/tp8_3.png" src="_images/tp8_3.png" style="width: 100%;" /></a>
</div>
<p>Puisque l‚Äôon obtient une nouvelle couche, il est ainsi possible d‚Äôenchainer plusieurs traitements de ce type de mani√®re simple.
Si je cherche √† cr√©er des polygones de Voronoi qui correspondent √† mes parks (cet algorithme n√©cessite une couche de points en entr√©e),
je peux ainsi r√©aliser les traitements suivants :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">mapLayersByName</span><span class="p">(</span><span class="s2">&quot;park&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># 1. Calcul des centroides</span>
<span class="n">result_centroids</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
  <span class="s2">&quot;native:centroids&quot;</span><span class="p">,</span>
  <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">input_layer</span><span class="p">,</span> <span class="s1">&#39;ALL_PARTS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;TEMPORARY_OUTPUT&#39;</span><span class="p">})</span>
<span class="n">centroid_layer</span> <span class="o">=</span> <span class="n">result_centroids</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
<span class="c1"># 2. Calcul des polygones de voronoi</span>
<span class="c1"># et choix d&#39;un chemin pour enregister le r√©sultat :</span>
<span class="n">result_voronoi</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
  <span class="s2">&quot;qgis:voronoipolygons&quot;</span><span class="p">,</span>
  <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">centroid_layer</span><span class="p">,</span> <span class="s1">&#39;BUFFER&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;TEMPORARY_OUTPUT&#39;</span><span class="p">})</span>
<span class="c1"># 3. Ajout des polygones de voronoi au projet</span>
<span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">result_voronoi</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_4.png"><img alt="_images/tp8_4.png" src="_images/tp8_4.png" style="width: 100%;" /></a>
</div>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_5.png"><img alt="_images/tp8_5.png" src="_images/tp8_5.png" style="width: 100%;" /></a>
</div>
<p>Ici <code class="docutils literal notranslate"><span class="pre">result_voronoi['OUTPUT']</span></code> est un objet de type <code class="docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code> comme manipul√© dans les TP pr√©c√©dents : il est possible de changer son nom dans l‚Äôinterface et ceci
est conseill√© afin d‚Äôidentifier plus facilement vos couches.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result_voronoi</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s1">&#39;voronoi_park&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_6.png"><img alt="_images/tp8_6.png" src="_images/tp8_6.png" style="width: 60%;" /></a>
</div>
</div>
<div class="section" id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Nous souhaitons en savoir plus sur le profil socio-d√©mographique des habitants de Paris en utilisant un d√©coupage original : celui qui peut √™tre obtenus √† partir des stations de m√©tros.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_7.png"><img alt="_images/tp8_7.png" src="_images/tp8_7.png" style="width: 100%;" /></a>
</div>
<p>En effet nous pourrions vouloir r√©pondre √† plusieurs questions telles que:</p>
<ul class="simple">
<li><strong>quels sont les niveaux de revenus √† proximit√© de ma station de m√©tro ?</strong></li>
<li>quelles stations de m√©tro sont situ√©es dans les zones les plus dens√©ment peupl√©es ?</li>
<li>aux alentour de quelles stations sont principalement localis√©es les r√©sidences secondaires ?</li>
</ul>
<p class="rubric"></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Nous allons r√©pondre √† la premi√®re de ces questions en utilisant les couches de donn√©es suivantes :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code> : les donn√©es socio-√©conomique disponibles au niveau des <a class="reference external" href="https://fr.wikipedia.org/wiki/%C3%8Elots_regroup%C3%A9s_pour_l%27information_statistique">IRIS</a> situ√©s √† Paris (les donn√©es proviennent de l‚ÄôAPUR <a class="footnote-reference" href="#f1" id="id1">[1]</a> et ont √©t√© enrichies avec des donn√©es de l‚ÄôINSEE <a class="footnote-reference" href="#f2" id="id2">[2]</a>). Le principal champ qui nous int√©resse dans cette couche est <code class="docutils literal notranslate"><span class="pre">RDEC_MED16</span></code> : le revenu m√©dian d√©clar√© par m√©nage.</li>
<li><code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code> : les stations de m√©tro situ√©es dans Paris (les donn√©es proviennent de l‚ÄôAPUR <a class="footnote-reference" href="#f3" id="id3">[3]</a>). Cette couche dispose notamment d‚Äôun champ nomm√© <code class="docutils literal notranslate"><span class="pre">L_STATION</span></code> : le nom de la station.</li>
</ul>
<p class="rubric"></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>0.</strong> T√©l√©charger l‚Äôarchive zipp√©e qui contient les donn√©es : <a class="reference external" href="https://mthh.github.io/TP_PythonQGIS/_static/data_pyqgis.zip">https://mthh.github.io/TP_PythonQGIS/_static/data_pyqgis.zip</a></p>
<p>La d√©compresser dans votre espace de travail.</p>
<p>Cr√©er un nouveau projet QGIS utilisant la projection <strong>EPSG:2154 (Lambert 93 / RGF 93)</strong>.</p>
<p>Ajouter les couches <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS.shp</span></code> et <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS.shp</span></code> et s‚Äôassurer qu‚Äôelles sont bien dans la m√™me projection que le projet.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_8.png"><img alt="_images/tp8_8.png" src="_images/tp8_8.png" style="width: 100%;" /></a>
</div>
<blockquote>
<div><strong>‚ö†</strong> <em>L‚Äôensemble des √©tapes suivantes doit √™tre effectu√© en Python. Une capture d‚Äô√©cran vous indique quel est le r√©sultat attendu √† l‚Äôissue de chaque √©tape.</em> <strong>‚ö†</strong></div></blockquote>
<p><strong>1.</strong> <strong>Obtenir une r√©f√©rence Python aux couches</strong> <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code> <strong>et</strong> <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code>. <strong>Appliquer le style du fichier</strong> <code class="docutils literal notranslate"><span class="pre">Style_STATION_METRO_PARIS.qml</span></code> <strong>√† la couche</strong> <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code>.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_9.png"><img alt="_images/tp8_9.png" src="_images/tp8_9.png" style="width: 100%;" /></a>
</div>
<p><strong>2.</strong> √Ä partir de la couche <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code> et en utilisant l‚Äôaglorithme <code class="docutils literal notranslate"><span class="pre">native:dissolve</span></code>, <strong>cr√©er une couche correspondant √† l‚Äôemprise de la ville de Paris</strong>.</p>
<p><strong>L‚Äôajouter au projet actuel et la renommer</strong> <code class="docutils literal notranslate"><span class="pre">COMMUNE_PARIS</span></code>.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_10.png"><img alt="_images/tp8_10.png" src="_images/tp8_10.png" style="width: 100%;" /></a>
</div>
<p><strong>3.</strong> En vous aidant de l‚Äôexemple vu au dessus, <strong>calculer les polygones de voronoi qui correspondant √† la couche</strong> <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code> <strong>en utilisant un buffer de 20%</strong>. Il n‚Äôest pas n√©cessaire d‚Äôajouter ce r√©sultat interm√©diaire au projet.</p>
<p>En utilisant vos connaissances en SIG, <strong>s√©lectionner puis √©x√©cuter ensuite le g√©otraitement qui vous permet de d√©couper ces polygones de voronoi par la couche obtenue</strong> <code class="docutils literal notranslate"><span class="pre">COMMUNE_PARIS</span></code> afin d‚Äôobtenir le r√©sultat qui suit.</p>
<p><strong>Ajouter ce r√©sultat au projet actuel et renommer la couche</strong> : <code class="docutils literal notranslate"><span class="pre">VORONOI_METRO_PARIS</span></code>.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_11.png"><img alt="_images/tp8_11.png" src="_images/tp8_11.png" style="width: 100%;" /></a>
</div>
<p><strong>4.</strong> En utilisant les notions vues dans les TP pr√©c√©dents, <strong>calculer, pour chaque polygone de Voronoi, la moyenne des salaires m√©dians</strong> (champ <code class="docutils literal notranslate"><span class="pre">RDEC_MED16</span></code>) <strong>des IRIS intersect√©s</strong> (couche <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code>).</p>
<p>Pour chaque polygone de Voronoi, cette valeur doit √™tre stock√©e dans le champ <code class="docutils literal notranslate"><span class="pre">MOY_RDEC</span></code> (pour <em>moyenne des revenus d√©clar√©s</em>) qu‚Äôil est n√©cessaire de cr√©er au pr√©alable.</p>
<p><strong>‚ö†</strong> Attention lors de la r√©alisation de ce calcul : les IRIS qui pr√©sentent la valeur 0 ne doivent pas √™tre pris en compte dans le calcul de la moyenne <em>(la valeur 0 n‚Äôindique pas un salaire m√©dian de 0 mais la non restitution de la valeur de l‚Äôindicateur pour l‚ÄôIRIS concern√© pour des raisons de confidentialit√© des donn√©es)</em>.</p>
<p>Enfin, <strong>appliquer le style</strong> <code class="docutils literal notranslate"><span class="pre">Style_VORONOI_METRO_PARIS.qml</span></code> <strong>√† la couche</strong> <code class="docutils literal notranslate"><span class="pre">VORONOI_METRO_PARIS</span></code>.</p>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_12.png"><img alt="_images/tp8_12.png" src="_images/tp8_12.png" style="width: 100%;" /></a>
</div>
<p><strong>5.</strong> En utilisant des √©l√©ments vus dans les TP pr√©c√©dents, <strong>√©crire le code n√©cessaire √† organiser les couches</strong> afin qu‚Äôelles apparaissent dans l‚Äôordre de la liste qui suit :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;STATION_METRO_PARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;VORONOI_METRO_PARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;COMMUNE_PARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;IRIS_MENAGE_PARIS&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="figure align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_13.png"><img alt="_images/tp8_13.png" src="_images/tp8_13.png" style="width: 100%;" /></a>
</div>
<p><strong>6.</strong> √âcrire une fonction Python <code class="docutils literal notranslate"><span class="pre">affiche_salaire_station</span></code> qui accepte un argument, le nom d‚Äôune station de m√©tro, et qui affiche la valeur calcul√©e √† l‚Äô√©tape 4.</p>
<p>Cette fonction doit donc se pr√©senter de la forme suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">affiche_salaire_station</span><span class="p">(</span><span class="n">nom_station</span><span class="p">):</span>
    <span class="c1"># le code permettant d&#39;afficher</span>
    <span class="c1"># la valeur pour la station &#39;nom_station&#39;</span>
</pre></div>
</div>
<p>Par exemple si on l‚Äôinvoque avec le nom <code class="docutils literal notranslate"><span class="pre">PORTE</span> <span class="pre">DE</span> <span class="pre">PANTIN</span></code> on doit obtenir le r√©sultat suivant :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">affiche_salaire_station</span><span class="p">(</span><span class="s1">&#39;PORTE DE PANTIN&#39;</span><span class="p">)</span>
<span class="c1"># &quot;La moyenne des salaires m√©dians autour de la station &#39;PORTE DE PANTIN&#39; est de 17048.71 euros&quot;</span>
</pre></div>
</div>
<p><strong>üöÄ Question bonus üöÄ</strong> Lors de l‚Äô√©tape <strong>4</strong> le calcul r√©alis√© n‚Äôest pas tr√®s pr√©cis : en effet, tous les IRIS qui intersectent un polygone de Voronoi
sont pris en compte √† √©galit√© alors qu‚Äôil serait plus correct de prendre en compte ces valeurs au prorata des surfaces concern√©es lors du calcul de la moyenne.</p>
<p><strong>R√©p√©ter la logique de la question 4 en mettant en oeuvre la consigne pr√©c√©dente en stockant cette fois le r√©sultat dans un champ appel√©</strong> <code class="docutils literal notranslate"><span class="pre">MOY_RDEC_P</span></code> (pour <em>moyenne des revenus d√©clar√©s au prorata</em>).</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>APUR (Atelier Parisien d‚ÄôUrbanisme) - Jeu de donn√©es ¬´&nbsp;RECENSEMENT IRIS MENAGE&nbsp;¬ª : <a class="reference external" href="https://opendata.apur.org/datasets/recensement-iris-menage">https://opendata.apur.org/datasets/recensement-iris-menage</a>. Donn√©es t√©l√©charg√©es le 08/04/2020.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>INSEE - Jeu de donn√©es&nbsp;¬ª Revenus, pauvret√© et niveau de vie en 2016 (IRIS)&nbsp;¬ª&nbsp;¬ª : <a class="reference external" href="https://www.insee.fr/fr/statistiques/4295611">https://www.insee.fr/fr/statistiques/4295611</a>. Donn√©es t√©l√©charg√©es le 08/04/2020.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>APUR (Atelier Parisien d‚ÄôUrbanisme) - Jeu de donn√©es ¬´&nbsp;STATION TRANSPORT&nbsp;¬ª : <a class="reference external" href="https://opendata.apur.org/datasets/station-transport">https://opendata.apur.org/datasets/station-transport</a>. Donn√©es t√©l√©charg√©es le 08/04/2020.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="ex6.html" title="Chapitre pr√©c√©dent (use the left arrow)">Exercice 6 : Manipulation de couches vecteurs et g√©otraitements</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="cheatsheet.html" title="Chapitre suivant (use the right arrow)">Cheatsheet</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index g√©n√©ral"
             >index</a></li>
        <li class="right" >
          <a href="cheatsheet.html" title="Cheatsheet"
             >suivant</a> |</li>
        <li class="right" >
          <a href="ex6.html" title="Exercice 6 : Manipulation de couches vecteurs et g√©otraitements"
             >pr√©c√©dent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation PythonQGIS_TP 2020</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018-2021, Matthieu Viry. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>