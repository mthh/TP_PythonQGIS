
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Exercice noté, à faire à la maison : Boite à outils de géotraitement &#8212; Documentation PythonQGIS_TP 2023.03</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/guzzle.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/js/custom.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Cheatsheet" href="cheatsheet.html" />
    <link rel="prev" title="Exercice 6 : Automatisation d’actions répétitives" href="ex6.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cheatsheet.html" title="Cheatsheet"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="ex6.html" title="Exercice 6 : Automatisation d’actions répétitives"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation PythonQGIS_TP 2023.03</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Exercice noté, à faire à la maison : Boite à outils de géotraitement</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contenu</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Exercice noté, à faire à la maison : Boite à outils de géotraitement</a><ul>
<li><a class="reference internal" href="#objectif">Objectif</a></li>
<li><a class="reference internal" href="#nouvelles-notions">Nouvelles notions</a></li>
<li><a class="reference internal" href="#exercice">Exercice</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
  <h4>Sujet précédent</h4>
  <p class="topless"><a href="ex6.html"
                        title="Chapitre précédent">Exercice 6 : Automatisation d’actions répétitives</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="cheatsheet.html"
                        title="Chapitre suivant">Cheatsheet</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ex8.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="index.html">Docs</a></li>
              
              <li>Exercice noté, à faire à la maison : Boite à outils de géotraitement</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <section id="exercice-note-a-faire-a-la-maison-boite-a-outils-de-geotraitement">
<h1>Exercice noté, à faire à la maison : Boite à outils de géotraitement<a class="headerlink" href="#exercice-note-a-faire-a-la-maison-boite-a-outils-de-geotraitement" title="Lien permanent vers ce titre">¶</a></h1>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_0.png"><img alt="_images/tp8_0.png" src="_images/tp8_0.png" style="width: 40%;" /></a>
</figure>
<p class="rubric"></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="objectif">
<h2>Objectif<a class="headerlink" href="#objectif" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><p>Découvrir et utiliser les algorithmes de la boite à outils de géotraitement (<em>processing algorithms</em>) en Python.</p></li>
<li><p>Combiner plusieurs géotraitements pour répondre à une question d’analyse spatiale.</p></li>
</ul>
</section>
<section id="nouvelles-notions">
<h2>Nouvelles notions<a class="headerlink" href="#nouvelles-notions" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’ensemble des <strong>géotraitements</strong> disponibles sous forme de boites de dialogues dans QGIS est également accessible au travers de l’API Python.
C’est également le cas pour les géotraitements proposées dans QGIS par les extensions GRASS, SAGA et GDAL.</p>
<p>Contraitement aux manipulations que nous avons effectuées auparavant, ces géotraitements prennent en entrée une (ou plusieurs) couche(s) et produisent généralement une couche en sortie.
Il s’agit par exemple de traitements tels que :</p>
<ul class="simple">
<li><p>Création de Polygones Voronoi</p></li>
<li><p>Création d’une grille au format vecteur</p></li>
<li><p>Fusion des entités d’un couche</p></li>
<li><p>Rastériserisation d’une couche vecteur</p></li>
<li><p>Etc.</p></li>
</ul>
<p>En utilisant le code suivant, il est possible de lister l’ensemble des algorithmes disponibles dans QGIS :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">QgsApplication</span><span class="o">.</span><span class="n">processingRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">algorithms</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> --&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alg</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">alg</span><span class="o">.</span><span class="n">displayName</span><span class="p">()))</span>
</pre></div>
</div>
<p>Le texte qui s’affiche est de la forme :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">native</span><span class="p">:</span><span class="n">centroids</span> <span class="o">--&gt;</span> <span class="n">Centroïdes</span>
<span class="n">native</span><span class="p">:</span><span class="n">clip</span> <span class="o">--&gt;</span> <span class="n">Couper</span>
<span class="o">...</span>
</pre></div>
</div>
<p>La partie de gauche désigne l’idenfifiant de l’algorithme (<code class="docutils literal notranslate"><span class="pre">native:centroids</span></code> par exemple)
et celle de droite son intitulé (<code class="docutils literal notranslate"><span class="pre">Centroïdes</span></code> par exemple) dans la langue utilisée par QGIS <em>(ici le français - certains intitulés ne sont toutefois pas traduits)</em>.
Il est ainsi possible d’accéder en Python à l’ensemble des géotraitements de la boite à outils.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_1.png"><img alt="_images/tp8_1.png" src="_images/tp8_1.png" style="width: 100%;" /></a>
</figure>
<p>L’accès à ces algorithmes se fait via le module <code class="docutils literal notranslate"><span class="pre">processing</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">processing</span>
</pre></div>
</div>
<p><strong>➜ La fonction</strong> <code class="docutils literal notranslate"><span class="pre">algorithmHelp</span></code> <strong>va permettre d’afficher l’aide d’un algorithme</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">processing</span><span class="o">.</span><span class="n">algorithmHelp</span><span class="p">(</span><span class="s2">&quot;native:centroids&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Il est indispensable de lire la documentation d’un algorithme avant de l’utiliser : c’est elle qui indique quels sont les paramètres requis pour l’utiliser.</p>
<blockquote>
<div><p>L’aide des différents géotraitements peut également être affichée au format HTML à partir de la page : <a class="reference external" href="https://docs.qgis.org/3.10/en/docs/user_manual/processing_algs/index.html">https://docs.qgis.org/3.10/en/docs/user_manual/processing_algs/index.html</a>.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Centroïdes</span> <span class="p">(</span><span class="n">native</span><span class="p">:</span><span class="n">centroids</span><span class="p">)</span>

<span class="n">Cet</span> <span class="n">algorithme</span> <span class="n">créé</span> <span class="n">un</span> <span class="n">nouvelle</span> <span class="n">couche</span> <span class="n">de</span> <span class="nb">type</span> <span class="n">point</span><span class="p">,</span> <span class="n">ou</span> <span class="n">les</span> <span class="n">points</span> <span class="n">représentent</span> <span class="n">le</span> <span class="n">barycentre</span> <span class="n">des</span> <span class="n">entités</span> <span class="n">d</span><span class="s1">&#39;une couche d&#39;</span><span class="n">entrée</span><span class="o">.</span>

<span class="n">Les</span> <span class="n">attributs</span> <span class="n">associés</span> <span class="n">aux</span> <span class="n">points</span> <span class="n">dans</span> <span class="n">la</span> <span class="n">couche</span> <span class="n">de</span> <span class="n">sortie</span>  <span class="n">sont</span> <span class="n">ceux</span> <span class="n">des</span> <span class="n">points</span> <span class="n">de</span> <span class="n">la</span> <span class="n">couche</span> <span class="n">d</span><span class="s1">&#39;origine.</span>


<span class="o">----------------</span>
<span class="n">Input</span> <span class="n">parameters</span>
<span class="o">----------------</span>

<span class="n">INPUT</span><span class="p">:</span> <span class="n">Couche</span> <span class="n">source</span>

      <span class="n">Parameter</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QgsProcessingParameterFeatureSource</span>

      <span class="n">Accepted</span> <span class="n">data</span> <span class="n">types</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">ID</span> <span class="n">de</span> <span class="n">couche</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">nom</span> <span class="n">de</span> <span class="n">couche</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">couche</span> <span class="n">source</span>
              <span class="o">-</span> <span class="n">QgsProcessingFeatureSourceDefinition</span>
              <span class="o">-</span> <span class="n">QgsProperty</span>
              <span class="o">-</span> <span class="n">QgsVectorLayer</span>

<span class="n">ALL_PARTS</span><span class="p">:</span> <span class="n">Créer</span> <span class="n">un</span> <span class="n">centroïde</span> <span class="n">pour</span> <span class="n">chaque</span> <span class="n">partie</span>

      <span class="n">Parameter</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QgsProcessingParameterBoolean</span>

      <span class="n">Accepted</span> <span class="n">data</span> <span class="n">types</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">bool</span>
              <span class="o">-</span> <span class="nb">int</span>
              <span class="o">-</span> <span class="nb">str</span>
              <span class="o">-</span> <span class="n">QgsProperty</span>

<span class="n">OUTPUT</span><span class="p">:</span> <span class="n">Centroïdes</span>

      <span class="n">Parameter</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QgsProcessingParameterFeatureSink</span>

      <span class="n">Accepted</span> <span class="n">data</span> <span class="n">types</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">fichier</span> <span class="n">vecteur</span> <span class="n">de</span> <span class="n">destination</span><span class="p">,</span> <span class="n">par</span> <span class="n">ex</span><span class="o">.</span> <span class="s1">&#39;d:/test.shp&#39;</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span> <span class="n">pour</span> <span class="n">stocker</span> <span class="n">le</span> <span class="n">résultat</span> <span class="n">dans</span> <span class="n">une</span> <span class="n">couche</span> <span class="n">temporaire</span> <span class="n">en</span> <span class="n">mémoire</span>
              <span class="o">-</span> <span class="nb">str</span><span class="p">:</span> <span class="n">using</span> <span class="n">vector</span> <span class="n">provider</span> <span class="n">ID</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">destination</span> <span class="n">URI</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="s1">&#39;postgres:…&#39;</span> <span class="n">to</span> <span class="n">store</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">PostGIS</span> <span class="n">table</span>
              <span class="o">-</span> <span class="n">QgsProcessingOutputLayerDefinition</span>
              <span class="o">-</span> <span class="n">QgsProperty</span>

<span class="o">----------------</span>
<span class="n">Outputs</span>
<span class="o">----------------</span>

<span class="n">OUTPUT</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">QgsProcessingOutputVectorLayer</span><span class="o">&gt;</span>
      <span class="n">Centroïdes</span>
</pre></div>
</div>
<p>Cette aide nous apprend :</p>
<ul class="simple">
<li><p>Que l’algorithme s’utilise avec 3 paramètres d’entrée : <code class="docutils literal notranslate"><span class="pre">INPUT</span></code>, <code class="docutils literal notranslate"><span class="pre">ALL_PARTS</span></code> et <code class="docutils literal notranslate"><span class="pre">OUTPUT</span></code> <em>(nous allons voir comment les utiliser simplement ensuite)</em>,</p></li>
<li><p>Que le résultat attendu est de type <code class="docutils literal notranslate"><span class="pre">QgsProcessingOutputVectorLayer</span></code> : cet objet va nous permettre d’obtenir une couche de type <code class="docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code> comme manipulée dans les TP précédents si l’éxécution se déroule sans problème.</p></li>
</ul>
<p><strong>➜ La fonction</strong> <code class="docutils literal notranslate"><span class="pre">run</span></code> <strong>va permettre d’éxécuter l’algorithme</strong>.</p>
<p>Son premier argument est l’identifiant de l’algorithme à éxécuter et son second argument est un dictionnaire Python (objet <code class="docutils literal notranslate"><span class="pre">dict</span></code>) décrivant
les paramètres de l’algorithme (couche(s) en entrées, type de sortie, éventuelles options.)</p>
<p>L’exemple suivant utilise une de mes couches (nommée <code class="docutils literal notranslate"><span class="pre">park</span></code> dans mon projet QGIS) pour calculer le centroide de chaque entité.
Le résultat est stocké dans une couche temporaire en mémoire et est ajouté au projet actuel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">mapLayersByName</span><span class="p">(</span><span class="s2">&quot;park&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="s2">&quot;native:centroids&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">layer</span><span class="p">,</span> <span class="s1">&#39;ALL_PARTS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>L’exécution du code précédent correspond ainsi à l’action suivante dans l’interface de QGIS :</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_2.png"><img alt="_images/tp8_2.png" src="_images/tp8_2.png" style="width: 100%;" /></a>
</figure>
<p>Dans l’interface, on retrouve également après l’éxécution, dans l’onglet <code class="docutils literal notranslate"><span class="pre">Journal</span></code> le dictionnaire des <strong>paramètres en entrée</strong>
utilisé pour ce géotraitement :</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_3.png"><img alt="_images/tp8_3.png" src="_images/tp8_3.png" style="width: 100%;" /></a>
</figure>
<p>Puisque l’on obtient une nouvelle couche, il est ainsi possible d’enchainer plusieurs traitements de ce type de manière simple.
Si je cherche à créer des polygones de Voronoi qui correspondent à mes parks (cet algorithme nécessite une couche de points en entrée),
je peux ainsi réaliser les traitements suivants :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">mapLayersByName</span><span class="p">(</span><span class="s2">&quot;park&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># 1. Calcul des centroides</span>
<span class="n">result_centroids</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
  <span class="s2">&quot;native:centroids&quot;</span><span class="p">,</span>
  <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">input_layer</span><span class="p">,</span> <span class="s1">&#39;ALL_PARTS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span><span class="p">})</span>
<span class="n">centroid_layer</span> <span class="o">=</span> <span class="n">result_centroids</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
<span class="c1"># 2. Calcul des polygones de voronoi</span>
<span class="c1"># et choix d&#39;un chemin pour enregister le résultat :</span>
<span class="n">result_voronoi</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
  <span class="s2">&quot;qgis:voronoipolygons&quot;</span><span class="p">,</span>
  <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">centroid_layer</span><span class="p">,</span> <span class="s1">&#39;BUFFER&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span><span class="p">})</span>
<span class="c1"># 3. Ajout des polygones de voronoi au projet</span>
<span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">result_voronoi</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">])</span>
</pre></div>
</div>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_4.png"><img alt="_images/tp8_4.png" src="_images/tp8_4.png" style="width: 100%;" /></a>
</figure>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_5.png"><img alt="_images/tp8_5.png" src="_images/tp8_5.png" style="width: 100%;" /></a>
</figure>
<p>Ici <code class="docutils literal notranslate"><span class="pre">result_voronoi['OUTPUT']</span></code> est un objet de type <code class="docutils literal notranslate"><span class="pre">QgsVectorLayer</span></code> comme manipulé dans les TP précédents : il est possible de changer son nom dans l’interface et ceci
est conseillé afin d’identifier plus facilement vos couches.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result_voronoi</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s1">&#39;voronoi_park&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_6.png"><img alt="_images/tp8_6.png" src="_images/tp8_6.png" style="width: 60%;" /></a>
</figure>
</section>
<section id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¶</a></h2>
<p>Nous souhaitons en savoir plus sur le profil socio-démographique des habitants de Paris en utilisant un découpage original : celui qui peut être obtenus à partir des stations de métros.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_7.png"><img alt="_images/tp8_7.png" src="_images/tp8_7.png" style="width: 100%;" /></a>
</figure>
<p>En effet nous pourrions vouloir répondre à plusieurs questions telles que:</p>
<ul class="simple">
<li><p><strong>quels sont les niveaux de revenus à proximité de ma station de métro ?</strong></p></li>
<li><p>quelles stations de métro sont situées dans les zones les plus densément peuplées ?</p></li>
<li><p>aux alentour de quelles stations sont principalement localisées les résidences secondaires ?</p></li>
</ul>
<p class="rubric"></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Nous allons répondre à la première de ces questions en utilisant les couches de données suivantes :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code> : les données socio-économique disponibles au niveau des <a class="reference external" href="https://fr.wikipedia.org/wiki/%C3%8Elots_regroup%C3%A9s_pour_l%27information_statistique">IRIS</a> situés à Paris (les données proviennent de l’APUR <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> et ont été enrichies avec des données de l’INSEE <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>). Le principal champ qui nous intéresse dans cette couche est <code class="docutils literal notranslate"><span class="pre">RDEC_MED16</span></code> : le revenu médian déclaré par ménage.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code> : les stations de métro situées dans Paris (les données proviennent de l’APUR <a class="footnote-reference brackets" href="#f3" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>). Cette couche dispose notamment d’un champ nommé <code class="docutils literal notranslate"><span class="pre">L_STATION</span></code> : le nom de la station.</p></li>
</ul>
<p class="rubric"></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>0.</strong> Télécharger l’archive zippée qui contient les données : <a class="reference external" href="https://mthh.github.io/TP_PythonQGIS/_static/data_pyqgis.zip">https://mthh.github.io/TP_PythonQGIS/_static/data_pyqgis.zip</a></p>
<p>La décompresser dans votre espace de travail.</p>
<p>Créer un nouveau projet QGIS utilisant la projection <strong>EPSG:2154 (Lambert 93 / RGF 93)</strong>.</p>
<p>Ajouter les couches <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS.shp</span></code> et <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS.shp</span></code> et s’assurer qu’elles sont bien dans la même projection que le projet.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_8.png"><img alt="_images/tp8_8.png" src="_images/tp8_8.png" style="width: 100%;" /></a>
</figure>
<blockquote>
<div><p><strong>⚠</strong> <em>L’ensemble des étapes suivantes doit être effectué en Python. Une capture d’écran vous indique quel est le résultat attendu à l’issue de chaque étape.</em> <strong>⚠</strong></p>
</div></blockquote>
<p><strong>1.</strong> <strong>Obtenir une référence Python aux couches</strong> <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code> <strong>et</strong> <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code>. <strong>Appliquer le style du fichier</strong> <code class="docutils literal notranslate"><span class="pre">Style_STATION_METRO_PARIS.qml</span></code> <strong>à la couche</strong> <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code>.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_9.png"><img alt="_images/tp8_9.png" src="_images/tp8_9.png" style="width: 100%;" /></a>
</figure>
<p><strong>2.</strong> À partir de la couche <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code> et en utilisant l’aglorithme <code class="docutils literal notranslate"><span class="pre">native:dissolve</span></code>, <strong>créer une couche correspondant à l’emprise de la ville de Paris</strong>.</p>
<p><strong>L’ajouter au projet actuel et la renommer</strong> <code class="docutils literal notranslate"><span class="pre">COMMUNE_PARIS</span></code>.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_10.png"><img alt="_images/tp8_10.png" src="_images/tp8_10.png" style="width: 100%;" /></a>
</figure>
<p><strong>3.</strong> En vous aidant de l’exemple vu au dessus, <strong>calculer les polygones de voronoi qui correspondant à la couche</strong> <code class="docutils literal notranslate"><span class="pre">STATION_METRO_PARIS</span></code> <strong>en utilisant un buffer de 20%</strong>. Il n’est pas nécessaire d’ajouter ce résultat intermédiaire au projet.</p>
<p>En utilisant vos connaissances en SIG, <strong>sélectionner puis éxécuter ensuite le géotraitement qui vous permet de découper ces polygones de voronoi par la couche obtenue</strong> <code class="docutils literal notranslate"><span class="pre">COMMUNE_PARIS</span></code> afin d’obtenir le résultat qui suit.</p>
<p><strong>Ajouter ce résultat au projet actuel et renommer la couche</strong> : <code class="docutils literal notranslate"><span class="pre">VORONOI_METRO_PARIS</span></code>.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_11.png"><img alt="_images/tp8_11.png" src="_images/tp8_11.png" style="width: 100%;" /></a>
</figure>
<p><strong>4.</strong> En utilisant les notions vues dans les TP précédents, <strong>calculer, pour chaque polygone de Voronoi, la moyenne des salaires médians</strong> (champ <code class="docutils literal notranslate"><span class="pre">RDEC_MED16</span></code>) <strong>des IRIS intersectés</strong> (couche <code class="docutils literal notranslate"><span class="pre">IRIS_MENAGE_PARIS</span></code>).</p>
<p>Pour chaque polygone de Voronoi, cette valeur doit être stockée dans le champ <code class="docutils literal notranslate"><span class="pre">MOY_RDEC</span></code> (pour <em>moyenne des revenus déclarés</em>) qu’il est nécessaire de créer au préalable.</p>
<p><strong>⚠</strong> Attention lors de la réalisation de ce calcul : les IRIS qui présentent la valeur 0 ne doivent pas être pris en compte dans le calcul de la moyenne <em>(la valeur 0 n’indique pas un salaire médian de 0 mais la non restitution de la valeur de l’indicateur pour l’IRIS concerné pour des raisons de confidentialité des données)</em>.</p>
<p>Enfin, <strong>appliquer le style</strong> <code class="docutils literal notranslate"><span class="pre">Style_VORONOI_METRO_PARIS.qml</span></code> <strong>à la couche</strong> <code class="docutils literal notranslate"><span class="pre">VORONOI_METRO_PARIS</span></code>.</p>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_12.png"><img alt="_images/tp8_12.png" src="_images/tp8_12.png" style="width: 100%;" /></a>
</figure>
<p><strong>5.</strong> En utilisant des éléments vus dans les TP précédents, <strong>écrire le code nécessaire à organiser les couches</strong> afin qu’elles apparaissent dans l’ordre de la liste qui suit :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;STATION_METRO_PARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;VORONOI_METRO_PARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;COMMUNE_PARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;IRIS_MENAGE_PARIS&#39;</span><span class="p">]</span>
</pre></div>
</div>
<figure class="align-center" style="width: 98%">
<a class="reference internal image-reference" href="_images/tp8_13.png"><img alt="_images/tp8_13.png" src="_images/tp8_13.png" style="width: 100%;" /></a>
</figure>
<p><strong>6.</strong> Écrire une fonction Python <code class="docutils literal notranslate"><span class="pre">affiche_salaire_station</span></code> qui accepte un argument, le nom d’une station de métro, et qui affiche la valeur calculée à l’étape 4.</p>
<p>Cette fonction doit donc se présenter de la forme suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">affiche_salaire_station</span><span class="p">(</span><span class="n">nom_station</span><span class="p">):</span>
    <span class="c1"># le code permettant d&#39;afficher</span>
    <span class="c1"># la valeur pour la station &#39;nom_station&#39;</span>
</pre></div>
</div>
<p>Par exemple si on l’invoque avec le nom <code class="docutils literal notranslate"><span class="pre">PORTE</span> <span class="pre">DE</span> <span class="pre">PANTIN</span></code> on doit obtenir le résultat suivant :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">affiche_salaire_station</span><span class="p">(</span><span class="s1">&#39;PORTE DE PANTIN&#39;</span><span class="p">)</span>
<span class="c1"># &quot;La moyenne des salaires médians autour de la station &#39;PORTE DE PANTIN&#39; est de 17048.71 euros&quot;</span>
</pre></div>
</div>
<p>Attention à prendre en compte le cas ou le nom donné en argument ne correspond pas à une station existante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">affiche_salaire_station</span><span class="p">(</span><span class="s1">&#39;XYZ&#39;</span><span class="p">)</span>
<span class="c1"># &quot;La station &#39;XYZ&#39; n&#39;existe pas&quot;</span>
</pre></div>
</div>
<p><strong>🚀 Question bonus 🚀</strong> Lors de l’étape <strong>4</strong> le calcul réalisé n’est pas très précis : en effet, tous les IRIS qui intersectent un polygone de Voronoi
sont pris en compte à égalité alors qu’il serait plus correct de prendre en compte ces valeurs au prorata des surfaces concernées lors du calcul de la moyenne.</p>
<p><strong>Répéter la logique de la question 4 en mettant en oeuvre la consigne précédente en stockant cette fois le résultat dans un champ appelé</strong> <code class="docutils literal notranslate"><span class="pre">MOY_RDEC_P</span></code> (pour <em>moyenne des revenus déclarés au prorata</em>).</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>APUR (Atelier Parisien d’Urbanisme) - Jeu de données « RECENSEMENT IRIS MENAGE » : <a class="reference external" href="https://opendata.apur.org/datasets/recensement-iris-menage">https://opendata.apur.org/datasets/recensement-iris-menage</a>. Données téléchargées le 08/04/2020.</p>
</aside>
<aside class="footnote brackets" id="f2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>INSEE - Jeu de données » Revenus, pauvreté et niveau de vie en 2016 (IRIS) » » : <a class="reference external" href="https://www.insee.fr/fr/statistiques/4295611">https://www.insee.fr/fr/statistiques/4295611</a>. Données téléchargées le 08/04/2020.</p>
</aside>
<aside class="footnote brackets" id="f3" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>APUR (Atelier Parisien d’Urbanisme) - Jeu de données « STATION TRANSPORT » : <a class="reference external" href="https://opendata.apur.org/datasets/station-transport">https://opendata.apur.org/datasets/station-transport</a>. Données téléchargées le 08/04/2020.</p>
</aside>
</aside>
</section>
</section>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="ex6.html" title="Chapitre précédent (use the left arrow)">Exercice 6 : Automatisation d’actions répétitives</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="cheatsheet.html" title="Chapitre suivant (use the right arrow)">Cheatsheet</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="cheatsheet.html" title="Cheatsheet"
             >suivant</a> |</li>
        <li class="right" >
          <a href="ex6.html" title="Exercice 6 : Automatisation d’actions répétitives"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation PythonQGIS_TP 2023.03</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Exercice noté, à faire à la maison : Boite à outils de géotraitement</a></li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018-2023, Matthieu Viry. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>